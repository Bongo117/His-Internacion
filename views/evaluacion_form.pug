extends layout

block content
  .contenido-box
    h2.text-primary.mb-4= titulo
    
    .row
      // --- COLUMNA IZQUIERDA: FORMULARIO NUEVA EVOLUCIN ---
      .col-md-6
        .card.shadow-sm
          .card-header.bg-primary.text-white
            h5.mb-0  Nueva Evoluci贸n
          .card-body
            form(method="POST" action="/evaluaciones/guardar")
              input(type="hidden" name="id_admision" value=id_admision)
              
              .mb-3
                label.form-label Diagn贸stico / Observaciones
                textarea.form-control(name="diagnostico" required rows="4" placeholder="Describa el estado actual...")
              
              .mb-3
                label.form-label Tratamiento / Indicaciones
                textarea.form-control(name="tratamientos" required rows="4" placeholder="Medicaci贸n, estudios, dieta...")

              .form-check.mb-3.p-3.border.rounded.bg-light
                input.form-check-input#alta(type="checkbox" name="alta_medica")
                label.form-check-label.fw-bold.text-success(for="alta")  DAR ALTA MDICA (Finaliza la internaci贸n)

              .d-grid
                button.btn.btn-success(type="submit") Guardar Evoluci贸n
                a.btn.btn-link.text-secondary(href="/evaluaciones") Volver sin guardar

      // --- COLUMNA DERECHA: HISTORIAL CLNICO ---
      .col-md-6
        h4.mb-3  Historial Cl铆nico
        
        if historial.length === 0
          .alert.alert-info No hay evoluciones registradas a煤n.
        else
          div(style="max-height: 600px; overflow-y: auto;")
            each evo in historial
              .card.mb-3.border-left-primary
                .card-body
                  h6.card-subtitle.mb-2.text-muted 
                    // Formateamos la fecha feo pero funcional (puedes mejorarlo con librer铆as luego)
                    |  #{new Date(evo.fecha).toLocaleString()}
                  
                  p.card-text 
                    strong ┖ Diagn贸stico: 
                    | #{evo.diagnostico}
                  p.card-text 
                    strong  Tratamiento: 
                    | #{evo.tratamientos}
                  
                  if evo.alta
                    span.badge.bg-success ALTA OTORGADA