extends layout

block content
  .contenido-box
    div.d-flex.justify-content-between.align-items-center.mb-4
        h2 üè• Mapa de Habitaciones
        a.btn.btn-success(href="/habitaciones/nueva") + Nueva Habitaci√≥n

    if habitaciones.length == 0
      .alert.alert-warning No hay habitaciones registradas.
    else
      .row
        each h in habitaciones
          // L√≥gica de colores (Sem√°foro)
          - let ocupacion = h.camas_ocupadas || 0
          - let total = h.total_camas || 0
          - let colorCard = 'border-secondary'
          - if (total > 0 && ocupacion === total) colorCard = 'border-danger' 
          - if (total > 0 && ocupacion < total && ocupacion > 0) colorCard = 'border-warning'
          - if (total > 0 && ocupacion === 0) colorCard = 'border-success'

          .col-md-4.mb-4
            .card(class=colorCard).h-100.shadow-sm
              .card-header.d-flex.justify-content-between.align-items-center.bg-light
                strong= h.ala
                span.badge.bg-dark Hab. #{h.numero}
              
              .card-body
                h6.card-subtitle.mb-2.text-muted Capacidad M√°x: #{h.capacidad}
                
                // Barra de progreso visual de ocupaci√≥n
                .progress.mb-3(style="height: 10px;")
                  - let porcentaje = total > 0 ? (ocupacion / total) * 100 : 0
                  .progress-bar(
                    role="progressbar" 
                    style=`width: ${porcentaje}%` 
                    class=(ocupacion === total ? 'bg-danger' : 'bg-success')
                  )

                p.card-text
                    | Camas F√≠sicas: #{total} 
                    br
                    if ocupacion > 0
                        span.text-danger Ocupadas: #{ocupacion}
                    else
                        span.text-success Todas Libres
                
                if h.pacientes_nombres
                    hr
                    small.text-muted Pacientes:
                    div.fw-bold.text-primary.small= h.pacientes_nombres

              .card-footer.bg-transparent
                div.d-flex.justify-content-between.align-items-center
                    // Bot√≥n para agregar cama autom√°ticamente
                    if total < h.capacidad
                        form(method="POST" action=`/habitaciones/${h.id_habitacion}/agregar_cama`)
                            button.btn.btn-sm.btn-outline-primary(type="submit") ‚ûï Instalar Cama
                    else
                        button.btn.btn-sm.btn-light.text-muted(disabled) M√°x. alcanzado
                    
                    // Si quisieras ver el detalle fino (opcional, podr√≠as quitarlo)
                    // a.btn.btn-sm.btn-link(href="#") Detalles