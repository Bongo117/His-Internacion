extends layout

block content
  .contenido-box
    div.d-flex.justify-content-between.align-items-center.mb-4
        h2 üè• Mapa de Habitaciones
        a.btn.btn-success(href="/habitaciones/nueva") + Nueva Habitaci√≥n

    if habitaciones.length == 0
      .alert.alert-warning No hay habitaciones registradas.
    else
      .row
        each h in habitaciones
          // Calculamos porcentaje de ocupaci√≥n para el color
          - let ocupacion = h.camas_ocupadas || 0
          - let total = h.total_camas || 0
          - let colorCard = 'border-secondary'
          - if (total > 0 && ocupacion === total) colorCard = 'border-danger' // Llena
          - if (total > 0 && ocupacion < total && ocupacion > 0) colorCard = 'border-warning' // Mitad
          - if (total > 0 && ocupacion === 0) colorCard = 'border-success' // Vac√≠a

          .col-md-4.mb-4
            .card(class=colorCard).h-100.shadow-sm
              .card-header.d-flex.justify-content-between.align-items-center
                strong= h.ala
                span.badge.bg-dark Hab. #{h.numero}
              .card-body
                h5.card-title Capacidad: #{h.capacidad} camas
                p.card-text
                    | Camas instaladas: #{h.total_camas}
                    br
                    if ocupacion > 0
                        span.text-danger Ocupadas: #{ocupacion}
                    else
                        span.text-success Disponible
                
                if h.pacientes_nombres
                    hr
                    small.text-muted Ocupantes:
                    div.fw-bold.text-primary= h.pacientes_nombres
                else if total > 0
                    hr
                    small.text-success Habitaci√≥n vac√≠a
                else 
                    hr
                    small.text-danger ‚ö†Ô∏è Sin camas f√≠sicas

              .card-footer.text-center
                // Enlace r√°pido para gestionar las camas de ESA habitaci√≥n
                // (Para esto necesitar√≠amos un filtro en camas, pero por ahora lo dejamos gen√©rico o linkeamos a crear cama)
                a.btn.btn-sm.btn-outline-secondary(href="/camas") üõèÔ∏è Gestionar Camas