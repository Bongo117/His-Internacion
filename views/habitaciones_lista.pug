extends layout

block content
  .contenido-box
    div.d-flex.justify-content-between.align-items-center.mb-4
        h2 üè• Mapa de Habitaciones
        a.btn.btn-success(href="/habitaciones/nueva") + Nueva Habitaci√≥n

    if habitaciones.length == 0
      .alert.alert-warning No hay habitaciones registradas.
    else
      .row
        each h in habitaciones
          .col-md-4.mb-4
            .card.h-100.shadow-sm
              .card-header.d-flex.justify-content-between.align-items-center.bg-light
                strong= h.ala
                span.badge.bg-dark Hab. #{h.numero}
              
              .card-body
                h6.card-subtitle.mb-3.text-muted Capacidad: #{h.capacidad} camas
                
                // --- LISTA DE CAMAS INTERACTIVAS ---
                if h.camas.length === 0
                    p.text-muted.small üö´ Sin camas instaladas
                else
                    ul.list-group.list-group-flush
                        each cama in h.camas
                            li.list-group-item.d-flex.justify-content-between.align-items-center.px-0
                                // Informaci√≥n de la cama
                                div
                                    strong Cama #{cama.numero}: 
                                    
                                    if cama.estado === 'libre'
                                        span.badge.bg-success Libre
                                    else if cama.estado === 'ocupada'
                                        span.badge.bg-danger Ocupada
                                        div.small.text-primary.mt-1 üë§ #{cama.apellido}
                                    else if cama.estado === 'higienizando'
                                        span.badge.bg-warning.text-dark Limpieza
                                    else
                                        span.badge.bg-secondary= cama.estado
                                
                                // Acciones: Limpiar (R√°pido) o Editar (Detallado)
                                div
                                    if cama.estado === 'higienizando'
                                        form(method="POST" action=`/habitaciones/cama/${cama.id_cama}/limpiar` style="display:inline")
                                            button.btn.btn-sm.btn-outline-warning.me-1(type="submit" title="Marcar como limpia") üßπ
                                    
                                    //- BOT√ìN NUEVO: Editar Cama (Lleva al controlador de Camas)
                                    a.btn.btn-sm.btn-outline-secondary(href=`/camas/editar/${cama.id_cama}` title="Editar Estado/Detalles") ‚úèÔ∏è

              .card-footer.bg-transparent.text-center
                if h.camas.length < h.capacidad
                    form(method="POST" action=`/habitaciones/${h.id_habitacion}/agregar_cama`)
                        button.btn.btn-sm.btn-outline-primary(type="submit") ‚ûï Instalar Cama
                else
                    small.text-muted Cupo m√°ximo de camas alcanzado