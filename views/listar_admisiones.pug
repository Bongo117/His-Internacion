extends layout

block content
  .fondo-admisiones
  .contenido-box
    h1= titulo

    table.table.table-striped
      thead
        tr
          th Paciente
          th Fecha de Admisi贸n
          th Motivo
          th Tipo de Ingreso
          th Cama
          th Habitaci贸n
          th Estado
          th Acciones
      tbody
        each admision in admisiones
          //- Detectar si es un paciente NN (por nombre o DNI temporal)
          - let esNN = admision.nombre === 'IDENTIDAD' && admision.apellido === 'DESCONOCIDA'
          
          tr(class=esNN ? 'table-warning' : '')
            td
              if esNN
                strong.text-danger  PACIENTE NN (Sin Identificar)
              else
                = admision.nombre + ' ' + admision.apellido
            td= new Date(admision.fecha_admision).toLocaleDateString('es-AR')
            td= admision.motivo
            td= admision.tipo_ingreso
            td= admision.cama_numero
            td= admision.habitacion_numero
            td= admision.estado
            td 
              .d-flex.flex-column.gap-2
                //- El bot贸n de detalle siempre est谩 disponible
                a.btn.btn-info.btn-sm.w-100(href=`/admisiones/${admision.id_admision}/detalle`)
                  i.bi.bi-eye-fill.me-1
                  | Ver Detalle

                if admision.estado === 'activa'
                  //- Si es NN, la acci贸n principal es Identificar
                  if esNN
                    a.btn.btn-danger.btn-sm.w-100.fw-bold(href=`/admisiones/identificar/${admision.id_admision}`) 
                      i.bi.bi-person-vcard.me-1
                      | IDENTIFICAR
                  
                  //- Siempre se puede evolucionar si est谩 activa
                  a.btn.btn-primary.btn-sm.w-100(href=`/evaluaciones/nueva/${admision.id_admision}`)
                    i.bi.bi-pencil-square.me-1
                    | Evolucionar

                  //- Si NO es NN, se puede finalizar/cancelar
                  if !esNN
                    form(method="POST", action=`/admisiones/${admision.id_admision}/finalizar`)
                      button.btn.btn-danger.btn-sm.w-100(type="submit", onclick="return confirm('驴Finalizar esta admisi贸n?');")
                        i.bi.bi-check-circle-fill.me-1
                        | Finalizar
                    form(method="POST", action=`/admisiones/${admision.id_admision}/cancelar`)
                      button.btn.btn-secondary.btn-sm.w-100(type="submit", onclick="return confirm('驴Cancelar esta admisi贸n?');")
                        i.bi.bi-x-circle-fill.me-1
                        | Cancelar

    a.btn.btn-secondary.mt-3(href="/") Volver al inicio
